<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F1 25 Telemetry - Live Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #ffffff;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #e10600, #ff4444);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            margin-top: 10px;
        }

        .status.connected {
            background: rgba(0, 255, 0, 0.2);
            color: #00ff00;
            border: 1px solid #00ff00;
        }

        .status.disconnected {
            background: rgba(255, 0, 0, 0.2);
            color: #ff4444;
            border: 1px solid #ff4444;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status.connected .status-dot {
            background: #00ff00;
        }

        .status.disconnected .status-dot {
            background: #ff4444;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 24px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
        }

        .card-title {
            font-size: 0.85em;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #888;
            margin-bottom: 12px;
            font-weight: 600;
        }

        .card-value {
            font-size: 3em;
            font-weight: 700;
            line-height: 1;
            background: linear-gradient(45deg, #ffffff, #cccccc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .card-unit {
            font-size: 0.4em;
            color: #666;
            margin-left: 8px;
        }

        .session-info {
            grid-column: 1 / -1;
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
        }

        .info-item {
            text-align: center;
        }

        .info-label {
            font-size: 0.85em;
            color: #888;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .info-value {
            font-size: 1.5em;
            font-weight: 600;
            color: #ffffff;
        }

        .telemetry-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .telemetry-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
        }

        .telemetry-label {
            font-size: 0.9em;
            color: #888;
        }

        .telemetry-value {
            font-size: 1.2em;
            font-weight: 600;
            color: #ffffff;
        }

        .lap-time {
            font-family: 'Courier New', monospace;
            font-size: 3.5em !important;
        }

        .sector-times {
            display: flex;
            justify-content: space-around;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sector {
            text-align: center;
        }

        .sector-label {
            font-size: 0.75em;
            color: #888;
            margin-bottom: 4px;
        }

        .sector-value {
            font-size: 1.1em;
            font-weight: 600;
            font-family: 'Courier New', monospace;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 8px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #e10600, #ff4444);
            transition: width 0.3s ease;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #666;
            font-size: 0.9em;
        }

        .last-update {
            font-size: 0.8em;
            color: #666;
            margin-top: 8px;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 1.8em;
            }
            
            .card-value {
                font-size: 2.5em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üèéÔ∏è F1 25 Telemetry Dashboard</h1>
            <div id="status" class="status disconnected">
                <span class="status-dot"></span>
                <span id="statusText">Waiting for data...</span>
            </div>
        </header>

        <div class="card session-info">
            <div class="info-item">
                <div class="info-label">Track</div>
                <div class="info-value" id="trackName">Unknown</div>
            </div>
            <div class="info-item">
                <div class="info-label">Session</div>
                <div class="info-value" id="sessionType">Unknown</div>
            </div>
            <div class="info-item">
                <div class="info-label">Driver</div>
                <div class="info-value" id="driverName">Unknown</div>
            </div>
            <div class="info-item">
                <div class="info-label">Lap</div>
                <div class="info-value" id="lapNumber">0</div>
            </div>
        </div>

        <div class="grid">
            <div class="card">
                <div class="card-title">Current Lap Time</div>
                <div class="card-value lap-time" id="currentLapTime">0:00.000</div>
            </div>

            <div class="card">
                <div class="card-title">Last Lap Time</div>
                <div class="card-value lap-time" id="lastLapTime">0:00.000</div>
                <div class="sector-times">
                    <div class="sector">
                        <div class="sector-label">S1</div>
                        <div class="sector-value" id="sector1">--</div>
                    </div>
                    <div class="sector">
                        <div class="sector-label">S2</div>
                        <div class="sector-value" id="sector2">--</div>
                    </div>
                    <div class="sector">
                        <div class="sector-label">S3</div>
                        <div class="sector-value" id="sector3">--</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">Speed</div>
                <div class="card-value">
                    <span id="speed">0</span>
                    <span class="card-unit">km/h</span>
                </div>
            </div>

            <div class="card">
                <div class="card-title">Gear</div>
                <div class="card-value" id="gear">N</div>
            </div>

            <div class="card">
                <div class="card-title">Engine RPM</div>
                <div class="card-value">
                    <span id="rpm">0</span>
                    <span class="card-unit">rpm</span>
                </div>
            </div>

            <div class="card">
                <div class="card-title">Car Telemetry</div>
                <div class="telemetry-grid">
                    <div class="telemetry-item">
                        <span class="telemetry-label">Throttle</span>
                        <span class="telemetry-value"><span id="throttle">0</span>%</span>
                    </div>
                    <div class="telemetry-item">
                        <span class="telemetry-label">Brake</span>
                        <span class="telemetry-value"><span id="brake">0</span>%</span>
                    </div>
                    <div class="telemetry-item">
                        <span class="telemetry-label">DRS</span>
                        <span class="telemetry-value" id="drs">OFF</span>
                    </div>
                    <div class="telemetry-item">
                        <span class="telemetry-label">Steering</span>
                        <span class="telemetry-value" id="steering">0.00</span>
                    </div>
                </div>
                <div class="progress-bar" title="Throttle">
                    <div class="progress-fill" id="throttleBar" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <footer>
            <div>F1 25 Telemetry Dashboard - Proof of Concept</div>
            <div class="last-update">Last update: <span id="lastUpdate">Never</span></div>
        </footer>
    </div>

    <script>
        // WebSocket connection
        const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
        const wsUrl = `${protocol}//${window.location.host}`;
        let ws;
        let reconnectInterval;

        // DOM elements
        const elements = {
            status: document.getElementById('status'),
            statusText: document.getElementById('statusText'),
            trackName: document.getElementById('trackName'),
            sessionType: document.getElementById('sessionType'),
            driverName: document.getElementById('driverName'),
            lapNumber: document.getElementById('lapNumber'),
            currentLapTime: document.getElementById('currentLapTime'),
            lastLapTime: document.getElementById('lastLapTime'),
            sector1: document.getElementById('sector1'),
            sector2: document.getElementById('sector2'),
            sector3: document.getElementById('sector3'),
            speed: document.getElementById('speed'),
            gear: document.getElementById('gear'),
            rpm: document.getElementById('rpm'),
            throttle: document.getElementById('throttle'),
            brake: document.getElementById('brake'),
            drs: document.getElementById('drs'),
            steering: document.getElementById('steering'),
            throttleBar: document.getElementById('throttleBar'),
            lastUpdate: document.getElementById('lastUpdate')
        };

        function connect() {
            console.log('Connecting to WebSocket:', wsUrl);
            ws = new WebSocket(wsUrl);

            ws.onopen = () => {
                console.log('WebSocket connected');
                elements.statusText.textContent = 'Connected - Waiting for telemetry...';
                clearInterval(reconnectInterval);
            };

            ws.onmessage = (event) => {
                try {
                    const data = JSON.parse(event.data);
                    updateDashboard(data);
                } catch (error) {
                    console.error('Error parsing message:', error);
                }
            };

            ws.onerror = (error) => {
                console.error('WebSocket error:', error);
            };

            ws.onclose = () => {
                console.log('WebSocket disconnected');
                elements.status.className = 'status disconnected';
                elements.statusText.textContent = 'Disconnected - Reconnecting...';
                
                // Attempt to reconnect every 3 seconds
                reconnectInterval = setInterval(() => {
                    if (ws.readyState === WebSocket.CLOSED) {
                        connect();
                    }
                }, 3000);
            };
        }

        function updateDashboard(data) {
            // Update connection status
            if (data.connected) {
                elements.status.className = 'status connected';
                elements.statusText.textContent = 'Connected - Receiving telemetry';
            } else {
                elements.status.className = 'status disconnected';
                elements.statusText.textContent = 'Connected - No telemetry data';
            }

            // Update session info
            elements.trackName.textContent = data.trackName || 'Unknown';
            elements.sessionType.textContent = data.sessionType || 'Unknown';
            elements.driverName.textContent = data.driverName || 'Unknown';
            elements.lapNumber.textContent = data.lapNumber || '0';

            // Update lap times
            elements.currentLapTime.textContent = data.currentLapTime || '0:00.000';
            elements.lastLapTime.textContent = data.lastLapTime || '0:00.000';
            elements.sector1.textContent = data.sector1Time || '--';
            elements.sector2.textContent = data.sector2Time || '--';
            
            // Calculate sector 3 (total - s1 - s2)
            if (data.sector1Time && data.sector2Time && data.lastLapTime) {
                elements.sector3.textContent = data.sector3Time || '--';
            }

            // Update telemetry
            elements.speed.textContent = data.speed || '0';
            
            // Format gear display
            const gear = data.gear;
            if (gear === -1) {
                elements.gear.textContent = 'R';
            } else if (gear === 0) {
                elements.gear.textContent = 'N';
            } else {
                elements.gear.textContent = gear;
            }
            
            elements.rpm.textContent = (data.rpm || 0).toLocaleString();
            elements.throttle.textContent = data.throttle || '0';
            elements.brake.textContent = data.brake || '0';
            elements.drs.textContent = data.drs ? 'ON' : 'OFF';
            elements.steering.textContent = (data.steering || 0).toFixed(2);
            
            // Update throttle bar
            elements.throttleBar.style.width = `${data.throttle || 0}%`;

            // Update last update time
            const now = new Date();
            elements.lastUpdate.textContent = now.toLocaleTimeString();
        }

        // Initialize connection
        connect();

        // Fallback: Poll REST API if WebSocket fails
        setInterval(() => {
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                fetch('/api/data')
                    .then(response => response.json())
                    .then(data => updateDashboard(data))
                    .catch(error => console.error('Error fetching data:', error));
            }
        }, 2000);
    </script>
</body>
</html>

